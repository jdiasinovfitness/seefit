<!-- Page Header -->
<ion-header>
  <ion-toolbar></ion-toolbar>
</ion-header>

<div class="filter-bar">
  <!-- TODO: Group all in one action Sheet for small devices -->
  <!-- Search -->
  <ion-searchbar [debounce]="500"
                 (ionChange)="handleSearch($event)"
                 [value]="searchValue"></ion-searchbar>

  <!-- Sort -->
  <!-- <ion-button shape="round"
        color="light"
        size="small"
        (click)="onSort($event)"
        id="sort-trigger">
        <ion-icon slot="icon-only"
        name="refresh"></ion-icon>
      </ion-button> -->

  <!-- Filter -->
  <ion-button shape="round"
              color="light"
              size="small"
              id="filter-trigger">
    <ion-icon slot="icon-only"
              name="funnel"></ion-icon>
  </ion-button>

  <ion-popover trigger="filter-trigger"
               triggerAction="click">
    <ng-template>
      <ion-content class="ion-padding">Insert Filters Here</ion-content>
    </ng-template>
  </ion-popover>

</div>

<!-- Page Content -->
<ion-content>
  <!-- Refresher -->
  <ion-refresher slot="fixed"
                 (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>


  <!-- List -->
  <ion-accordion-group>
    <ion-accordion [value]="i"
                   *ngFor="let item of list; let i = index">

      <!-- TODO: refactor the ion-item to ici-list-header -->
      <!-- <app-ici-list-header item></app-ici-list-header> -->
      <ion-item slot="header"
                color="light">

        <div class="icon-avatar">

          <div class="col-icons">
            <ion-icon slot="icon-only"
                      *ngFor="let icon of item?.customerInfo?.additionalInfo?.icons | slice:0:3"
                      [name]="icon"
                      color="medium">
            </ion-icon>
          </div>

          <!-- Avatar -->
          <ion-avatar>
            <img alt="Silhouette of a person's head"
                 [src]="item?.imageUrl" />
          </ion-avatar>

        </div>

        <div class="col-wrapper">

          <!-- Left Column -->
          <div class="column">
            <!-- Title -->
            <ion-label>
              <ion-text color="primary">
                <b>{{item?.title}}</b>
              </ion-text>
            </ion-label>
            <!-- Risk -->
            <ion-label>
              <ion-text color="medium">
                {{item?.primary?.label}}
              </ion-text>
              <ion-text color="secondary">
                {{item?.primary?.value}}
              </ion-text>
            </ion-label>
            <!-- Usage -->
            <ion-label>
              <ion-text color="medium">
                {{item?.secondary?.label}}
              </ion-text>
              <ion-text color="secondary">
                {{item?.secondary?.value}}
              </ion-text>
            </ion-label>
          </div>

          <!-- Right Column -->
          <div class="column right"
               slot="end">
            <!-- Interaction Type -->
            <ion-label class="right">
              <ion-text color="secondary">
                {{item?.interaction?.value}}
              </ion-text>
            </ion-label>
            <!-- Date -->
            <ion-label class="right">
              <ion-text color="medium">
                {{item?.date}}
              </ion-text>
            </ion-label>
            <!-- Status -->
            <div class="right">
              <ion-chip color="medium">
                <ion-text color="primary"
                          style="font-size: smaller;">
                  {{item?.status}}
                </ion-text>
              </ion-chip>
            </div>

          </div>
        </div>

      </ion-item>


      <!-- Expanded Content -->
      <div class="expanded-content"
           slot="content">

        <!-- Tab List -->
        <ion-segment [value]="activeTabList[i]"
                     (ionChange)="onTabChange($event, i)"
                     mode="md">
          <ion-segment-button *ngFor="let tab of tabs; let i = index"
                              [value]="tab.id">
            <ion-label>{{tab.title}}</ion-label>
          </ion-segment-button>
        </ion-segment>

        <!-- Tab Content -->
        <div *ngIf="activeTabList[i] === '0'">
          <app-customer-info [info]="item"
                             (handleClick)="onButtonClick($event)"></app-customer-info>
        </div>
        <div *ngIf="activeTabList[i] === '1'">
          <app-interaction-info [info]="item"
                                (handleClick)="onButtonClick($event)"></app-interaction-info>
        </div>
        <div *ngIf="activeTabList[i] === '2'">
          <app-history [info]="item"
                       (handleClick)="onButtonClick($event)"></app-history>
        </div>

      </div>

    </ion-accordion>
  </ion-accordion-group>
</ion-content>


<!-- Page Footer -->
<ion-footer color="transparent">
  <ion-chip>
    Some Footer
  </ion-chip>
</ion-footer>
